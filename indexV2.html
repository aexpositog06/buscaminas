<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuscaminasV3</title>
    <style>
        body {
            background-image: url("fondo.png");
            background-size: cover;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #controles {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        .boton {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .info {
            margin: 10px;
            font-size: 18px;
        }
        #fondo {
            display: grid;
            gap: 2px;
            margin: 20px auto;
            width: fit-content;
            background-color: black;
            padding: 5px;
        }
        .celda {
            width: 30px;
            height: 30px;
            background-color: lightgray;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid gray;
            font-size: 16px;
            cursor: pointer;
        }
        .mina {
            background-color: red !important;
        }
    </style>
</head>
<body>
    <h1>BuscaminasV3</h1>
    <div id="controles">
        <button class="boton" onclick="iniciarFacil()">Fácil</button>
        <button class="boton" onclick="iniciarMedio()">Medio</button>
        <button class="boton" onclick="iniciarDificil()">Difícil</button>
    </div>
    <div id="tiempo" class="info">Tiempo: 0</div>
    <div id="clicks" class="info">Clicks: 0</div>
    <div id="vidas" class="info">Vidas: 3</div>
    <div id="ayuda" class="info">Ayudas: 3</div>
    <div id="fondo"></div>

    <script>
        let tiempo = 0;
        let clicks = 0;
        let minasGeneradas = false;
        let totalCeldas, filasGlobal, columnasGlobal, totalMinas;

        function reiniciar() {
            tiempo = 0;
            clicks = 0;
            minasGeneradas = false;
            document.getElementById("tiempo").innerHTML = "Tiempo: " + tiempo;
            document.getElementById("clicks").innerHTML = "Clicks: " + clicks;
            document.getElementById("fondo").innerHTML = "";
        }

        function crearTablero(filas, columnas, minas) {
            reiniciar();
            filasGlobal = filas;
            columnasGlobal = columnas;
            totalMinas = minas;
            totalCeldas = filas * columnas;
            let fondo = document.getElementById("fondo");
            fondo.style.gridTemplateColumns = `repeat(${columnas}, 30px)`;

            for (let i = 0; i < totalCeldas; i++) {
                let celda = document.createElement("div");
                celda.classList.add("celda");
                celda.dataset.index = i;

                celda.addEventListener("click", () => manejarClick(celda));

                fondo.appendChild(celda);
            }
        }

        function generarMinas(excluirIndice) {
            let posiciones = new Set();
            while (posiciones.size < totalMinas) {
                let posicion = Math.floor(Math.random() * totalCeldas);
                if (posicion !== excluirIndice) {
                    posiciones.add(posicion);
                }
            }
            return posiciones;
        }

        function manejarClick(celda) {
            clicks++;
            document.getElementById("clicks").innerHTML = "Clicks: " + clicks;

            if (!minasGeneradas) {
                let indicePrimerClick = parseInt(celda.dataset.index);
                let minas = generarMinas(indicePrimerClick);
                document.querySelectorAll(".celda").forEach((c, index) => {
                    if (minas.has(index)) {
                        c.dataset.mina = "true";
                    }
                });
                minasGeneradas = true;
            }

        }

        function comprobar(){

        }

        function iniciarFacil() {
            crearTablero(5, 5, 5);
        }

        function iniciarMedio() {
            crearTablero(10, 10, 15);
        }

        function iniciarDificil() {
            crearTablero(15, 15, 30);
        }
        
    </script>
</body>
</html>
